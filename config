ngx_module_type=HTTP_AUX_FILTER

ngx_module_name=ngx_http_waf_rule_match_engine_module

# Enable debug mode
CFLAGS="$CFLAGS -DDDEBUG=1"

# 生成解析器文件
echo "Generating parser files..."
cd $ngx_addon_dir/src/rule_parser
bison -d rule_parser.y
flex rule_lexer.l
cd -

ngx_module_incs="$ngx_addon_dir/src/ $ngx_addon_dir/src/rule_parser/"

ngx_module_deps="$ngx_addon_dir/src/ngx_http_waf_rule_runtime.h \
                 $ngx_addon_dir/src/waf_rule_types.h \
                 $ngx_addon_dir/src/rbtree.h \
                 $ngx_addon_dir/src/ddebug.h \
                 $ngx_addon_dir/src/rule_parser/rule_parser.tab.h"

ngx_module_srcs="$ngx_addon_dir/src/rule_parser/rule_mg.c \
                 $ngx_addon_dir/src/rule_parser/rule_parser.tab.c \
                 $ngx_addon_dir/src/rule_parser/lex.yy.c \
                 $ngx_addon_dir/src/rule_parser/pattern_converter.c \
                 $ngx_addon_dir/src/rule_parser/hyperscan_utils.c \
                 $ngx_addon_dir/src/rbtree.c \
                 $ngx_addon_dir/src/auxiliary.c \
                 $ngx_addon_dir/src/waf_rule_match_engine_core.c \
                 $ngx_addon_dir/src/ngx_http_waf_rule_match_engine_module.c"

ngx_module_libs="-lhs -lm"

. auto/module
